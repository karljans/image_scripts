# ROSbag Image & Video Toolkit

Scripts for Image & Video Processing from ROSbags.

## extract.py - Rosbag Camera Frame Extractor

### Description

`extract.py` is a Python script designed to extract camera frames from rosbags, tested with the Rosbag2 format. It supports both compressed and uncompressed data and saves the frames as separate JPEG image files.

### Requirements

`pip install rosbags opencv-python numpy argparse`

### Usage

```bash
python extract.py --rosbag <path_to_rosbag> --dir <output_directory> [--uncompressed]
```

### Options

- `-h`, `--help`: Show the help message and exit.
- `--rosbag` or `-r`: Path to the Rosbag file from which camera frames will be extracted. Make sure the Rosbag file follows the Rosbag2 format.
- `--dir` or `-d`: Path to the output directory where the extracted JPEG images will be saved. The script will create the directory if it does not exist.
- `--uncompressed` or `-u`: (Optional) Include this flag if you want to extract uncompressed images. If not specified, the script will handle both compressed and uncompressed data.

### Usage Example

1. Extracting compressed images:

```bash
python extract.py --rosbag path/to/compressed_rosbag.bag --dir path/to/output_directory
```

2. Extracting uncompressed images:

```bash
python extract.py --rosbag path/to/uncompressed_rosbag.bag --dir path/to/output_directory --uncompressed
```

### Note:

- The extracted frames will be saved as individual JPEG files in the specified output directory.

## img_to_video.py - Image to Video Converter

Converts a folder of jpeg files into a video (such as the ones generated by `extract.py`). Uses sorted file names for determining the frame order.

### Description

`img_to_video.py` is a Python script that converts a series of images from an input directory (such as the ones created by `extract.py`) into an MP4 video file. The script provides options to set the framerate of the output video and optionally synchronize the video based on file timestamps.

### Requirements

```bash
pip install opencv-python argparse natsort
```

### Usage

```bash
python img_to_video.py --dir <input_directory> --video <output_video_file> [--fps <framerate>] [--sync]
```

### Options

- `-h`, `--help`: Show the help message and exit.
- `--dir` or `-d`: Path to the input directory containing the sequence of images. The images should be in a format compatible with OpenCV (e.g., JPEG, PNG).
- `--video` or `-v`: Path to the output video file. The script will save the generated video file in this location.
- `--fps` or `-f`: (Optional) Set the framerate of the output video. The default framerate is 30 frames per second.
- `--sync` or `-s`: (Optional) Include this flag if you want to synchronize the video based on timestamps in filenames. The script assumes the filenames are either unix timestamps or ordered frame numbers (e.g. `01.jpg`, `02.jpg`, etc).

### Usage Example

1. Convert images to a video with the default framerate (30 FPS):

```bash
python img_to_video.py --dir path/to/input_directory --video path/to/output_video.mp4
```

2. Convert images to a video with a custom framerate (e.g., 24 FPS):

```bash
python img_to_video.py --dir path/to/input_directory --video path/to/output_video.mp4 --fps 24
```

3. Convert images to a synchronized video based on timestamps:

```bash
python img_to_video.py --dir path/to/input_directory --video path/to/output_video.mp4 --sync
```

### Note:

- The output video will be saved in MP4 container using the h.264 codec.
- If the `--fps` option is not specified, the script will default to a framerate of 30 FPS.
- The script assumes the filenames are either unix timestamps or ordered frame numbers (e.g. `01.jpg`, `02.jpg`, etc) when using the `--sync`

# Object Detection and Create Labels

This repository contains a Python script for performing object detection using the YOLO model. The script takes a directory of raw/un-annotated images as input, performs object detection, and outputs labeled images with bounding boxes.

## Prerequisites

Before running the script, ensure you have the following dependencies installed:

- Python 3
- OpenCV (install it using `pip3` if not already installed):
  `pip3 install opencv-python`
- [detector.py](detector.py) - The script for object detection.


## Usage

The script can be used by running the following command:

```bash
python3 create_labes.py -i <input_dir> -w <weight_file> [-o <output_dir>] \
                            [-ct <conf_thresh>] [-iout <iou_thresh>] \
                            [-objs <objects>] [-msize <model_size>] \
                            [-ext <image_extension>] [-nc <number_of_classes>] \
                            [-cn <class_names>] [-cf_name <class_file_name>]
```

- **input_dir** (required): Path to the directory containing raw/un-annotated images.
- **weight_file** (required): Path to the weight file for the YOLO model.
- **output_dir**: Path to the directory where processed/annotated images with bounding boxes will be saved. If not specified, the labeled images will be saved in the input directory.
- **conf_thresh**: Confidence threshold value for detection. Default: 0.6.
- **iou_thresh**: Intersection over Union (IoU) threshold value for detection. Default: 0.3.
- **objects**: List of desired objects to detect. Default: [0, 1] (index of classes).
- **model_size**: Size of the model for detection. Default: 1280.
- **image_extension**: Extension of the image files. Default: "jpg".
- **number_of_classes**: Number of classes in the dataset. Default: 2.
- **class_names**: List of names of classes. Default: ["buoy", "vessel"].
- **class_file_name**: Path to the file to write class names and the number of classes. Default: None (no class file will be created).

**Note**: Uncomment the `create_subdirectories(label_dir)` line (remove `#`) to create subdirectories for labeling.

## Output

The script will process each image in the input directory, detect objects using the YOLO model, and save the labeled images with bounding boxes in the output directory (or the input directory if output directory not specified). Additionally, if `class_file_name` is provided, it will create a file containing class names and the number of classes.

## Contact

For any questions or issues, please contact the support team at support@example.com.
